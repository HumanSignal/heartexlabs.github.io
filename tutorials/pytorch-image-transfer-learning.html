


<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
      <title>Label Studio</title>
      <meta charset="utf-8">
      <meta name="description" content="Label Studio - Data labeling, annotation and exploration tool">
      <meta name="viewport" content="width=device-width, initial-scale=1">

      <meta property="og:type" content="article">
      <meta property="og:title" content="Label Studio">
      <meta property="og:description" content="Label Studio - Data labeling, annotation and exploration tool">
      <meta property="og:image" content="https://repository-images.githubusercontent.com/192640529/6b34d180-dd95-11e9-8016-fddd7751cb2c">
      <meta name="thumbnail" content="https://labelstud.io/images/opossum/heartex_icon_opossum_green@2x.png">


      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="Label Studio">
      <meta name="twitter:description" content="Label Studio - Data labeling, annotation and exploration tool">
      <meta name="twitter:image" content="https://labelstud.io/images/opossum/heartex_icon_opossum_green@2x.png">

      <meta name="msapplication-TileColor" content="#4fc08d">
      <meta name="theme-color" content="#4fc08d">

      <meta name="msapplication-config" content="browserconfig.xml">
      <link rel="manifest" href="/manifest.json">

      <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">

      <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono" rel="stylesheet" type="text/css">
      <link href="//fonts.googleapis.com/css?family=Dosis:500&text=LabelStudio" rel="stylesheet" type="text/css">

      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

      <!-- Place this tag in your head or just before your close body tag. -->
      <script src="/js/jquery.min.js"></script>
      <script async defer src="https://buttons.github.io/buttons.js"></script>
      <script src="/js/search.js"></script>

      <script src="/js/smooth-scroll.min.js"></script>

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">
    <link rel="stylesheet" href="/css/search.css">

    

    <!-- this needs to be loaded before guide's inline scripts -->

  </head>
  <body class="docs">
    <div id="mobile-bar">
        <a class="menu-button"></a>
    </div>
     <div id="header">
  <a id="logo" href="/">
    <img src="/images/ls_logo.png" alt="label studio logo">
    <span style="font-size: 1.2em;">Label Studio</span>
  </a>
  <ul id="nav" style="display: flex; align-items: center">
    
<a href="/guide" class>Guide</a>
<a href="/tags" class>Tags</a>
<a href="/templates" class>Templates</a>
<a href="/playground" class>Playground</a>
<a href="/blog" class>Blog</a>

<!-- Github starts -->
<div style="margin: 7px 0 0 7px !important;" class="github-button-wrap">
    <a class="github-button" href="https://github.com/heartexlabs/label-studio" data-icon="octicon-star" " data-size="large" data-show-count="true" aria-label="Star heartexlabs/label-studio on GitHub"></a>
</div>

<!-- Github repo -->
<img src="/images/github-icon.png" height="25px" style="margin-left: 10px; cursor:pointer" class="github-link" onclick="window.location='https://github.com/heartexlabs/label-studio'">

<!-- Search -->
<div id="site_search">
  <input type="text" id="local-search-input" name="q" results="0" autofocus placeholder="Search" class="st-search-input st-default-search-input form-control">
</div>

  </ul>
</div>


 

    
        <div id="main" class="fix-sidebar">
            
  <div class="sidebar">
    <ul class="main-menu">
      
<a href="/guide" class>Guide</a>
<a href="/tags" class>Tags</a>
<a href="/templates" class>Templates</a>
<a href="/playground" class>Playground</a>
<a href="/blog" class>Blog</a>

<!-- Github starts -->
<div style="margin: 7px 0 0 7px !important;" class="github-button-wrap">
    <a class="github-button" href="https://github.com/heartexlabs/label-studio" data-icon="octicon-star" " data-size="large" data-show-count="true" aria-label="Star heartexlabs/label-studio on GitHub"></a>
</div>

<!-- Github repo -->
<img src="/images/github-icon.png" height="25px" style="margin-left: 10px; cursor:pointer" class="github-link" onclick="window.location='https://github.com/heartexlabs/label-studio'">

<!-- Search -->
<div id="site_search">
  <input type="text" id="local-search-input" name="q" results="0" autofocus placeholder="Search" class="st-search-input st-default-search-input form-control">
</div>

    </ul>
  </div>

<div class="content   ">

  <div id="local-search-result-wrapper"></div>
  <script>
      var search_path = "search.xml";
      if (search_path.length === 0) {
        search_path = "search.xml";
      }
      var path = "/" + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result-wrapper');
  </script>

  
  
  <h2 id="Transfer-learning-for-images-with-PyTorch"><a href="#Transfer-learning-for-images-with-PyTorch" class="headerlink" title="Transfer learning for images with PyTorch"></a>Transfer learning for images with PyTorch</h2><p>It explains the basics of computer vision with Label Studio and <a href="https://pytorch.org/" target="_blank" rel="noopener">PyTorch</a>.<br>The proposed model leverages transfer learning from popular ResNet image classifier and able to be quickly finetuned to your own data.</p>
<p>The example labeling config could be</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"image_object"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$image_url"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Choices</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"image_classes"</span> <span class="hljs-attr">toName</span>=<span class="hljs-string">"image_object"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Choice</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Cat"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Choice</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Dog"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Choices</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></code></pre>

<h3 id="Create-a-model-script"><a href="#Create-a-model-script" class="headerlink" title="Create a model script"></a>Create a model script</h3><p>If you create ML backend by using Label Studio’s ML SDK, you have to follow the rules:</p>
<ul>
<li>created model class should be inherited from <code>label_studio.ml.LabelStudioMLBase</code></li>
<li>2 methods should be overrided:<ul>
<li><code>predict()</code> takes <a href="/guide/tasks.html#Basic-format">input tasks</a> and outputs <a href="/guide/completions.html#predictions">predictions</a> in a Label Studio format</li>
<li><code>train()</code> receives <a href="/guide/completions.html#Basic-format">completions</a> iterable and returns dictionary with created links and resources. This dictionary will be later used for model loading via <code>self.train_output</code> field.</li>
</ul>
</li>
</ul>
<p>Create a file <code>model.py</code> with the PyTorch model for ready for training and inference.</p>
<p>First create <code>Dataset</code> class that takes list of image URLs as input and produces batch of preprocessed images with corresponding labels.</p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader
<span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> datasets, models, transforms

device = torch.device(<span class="hljs-string">'cuda:0'</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">'cpu'</span>)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageClassifierDataset</span><span class="hljs-params">(Dataset)</span>:</span>
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, image_urls, image_classes)</span>:</span>
        self.images = []
        self.labels = []
        
        self.classes = list(set(image_classes))
        self.class_to_label = &#123;c: i <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> enumerate(self.classes)&#125;
        
        self.image_size = <span class="hljs-number">224</span>
        self.transforms = transforms.Compose([
            transforms.Resize(self.image_size),
            transforms.CenterCrop(self.image_size),
            transforms.ToTensor(),
            transforms.Normalize([<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>], [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>])
        ])
        
        
        <span class="hljs-keyword">for</span> image_url, image_class <span class="hljs-keyword">in</span> zip(image_urls, image_classes):
            image = self._get_image_from_url(image_url)
            transformed_image = self.transforms(image)
            self.images.append(transformed_image)
            
            label = self.class_to_label[image_class]
            self.labels.append(label)
            
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_image_from_url</span><span class="hljs-params">(self, url)</span>:</span>
        <span class="hljs-keyword">pass</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span><span class="hljs-params">(self, index)</span>:</span>
        <span class="hljs-keyword">return</span> self.images[index], self.labels[index]
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> len(self.images)</code></pre>

<p>As the next step let’s make a simple wrapper for pretrained ResNet model</p>
<pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageClassifier</span><span class="hljs-params">(object)</span>:</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, num_classes)</span>:</span>
        self.model = models.resnet18(pretrained=<span class="hljs-literal">True</span>)
        num_ftrs = self.model.fc.in_features
        self.model.fc = nn.Linear(num_ftrs, num_classes)
        
        self.model = self.model.to(device)
        
        self.criterion = nn.CrossEntropyLoss()
        self.optimizer = optim.SGD(self.model.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)
        
        <span class="hljs-comment"># Decay LR by a factor of 0.1 every 7 epochs</span>
        self.scheduler = optim.lr_scheduler.StepLR(self.optimizer, step_size=<span class="hljs-number">7</span>, gamma=<span class="hljs-number">0.1</span>)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save</span><span class="hljs-params">(self, path)</span>:</span>
        torch.save(self.model.state_dict(), path)
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load</span><span class="hljs-params">(self, path)</span>:</span>
        self.model.load_state_dict(torch.load(path))
        self.model.eval()
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train</span><span class="hljs-params">(self, dataloader, num_epochs=<span class="hljs-number">25</span>)</span>:</span>
        since = time.time()

        self.model.train()
        <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(num_epochs):
            print(<span class="hljs-string">'Epoch &#123;&#125;/&#123;&#125;'</span>.format(epoch, num_epochs - <span class="hljs-number">1</span>))
            print(<span class="hljs-string">'-'</span> * <span class="hljs-number">10</span>)
            
            running_loss = <span class="hljs-number">0.0</span>
            running_corrects = <span class="hljs-number">0</span>    
            <span class="hljs-comment"># Iterate over data.</span>
            <span class="hljs-keyword">for</span> inputs, labels <span class="hljs-keyword">in</span> dataloader:
                inputs = inputs.to(device)
                labels = labels.to(device)

                self.optimizer.zero_grad()
                outputs = self.model(inputs)
                _, preds = torch.max(outputs, <span class="hljs-number">1</span>)
                loss = self.criterion(outputs, labels)
                loss.backward()
                self.optimizer.step()

                <span class="hljs-comment"># statistics</span>
                running_loss += loss.item() * inputs.size(<span class="hljs-number">0</span>)
                running_corrects += torch.sum(preds == labels.data)
                self.scheduler.step()

            epoch_loss = running_loss / len(dataloader.dataset)
            epoch_acc = running_corrects.double() / len(dataloader.dataset)

            print(<span class="hljs-string">'Train Loss: &#123;:.4f&#125; Acc: &#123;:.4f&#125;'</span>.format(epoch_loss, epoch_acc))

        print()
    
        time_elapsed = time.time() - since
        print(<span class="hljs-string">'Training complete in &#123;:.0f&#125;m &#123;:.0f&#125;s'</span>.format(time_elapsed // <span class="hljs-number">60</span>, time_elapsed % <span class="hljs-number">60</span>))

        <span class="hljs-keyword">return</span> self.model</code></pre>

<p>Finally override API methods</p>
<pre><code class="hljs python"><span class="hljs-keyword">from</span> label_studio.ml <span class="hljs-keyword">import</span> LabelStudioMLBase

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageClassifierAPI</span><span class="hljs-params">(LabelStudioMLBase)</span>:</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, **kwargs)</span>:</span>
        self.model = ImageClassifier(resources[<span class="hljs-string">'num_classes'</span>])
        self.model.load(resources[<span class="hljs-string">'model_path'</span>])
        self.labels = resources[<span class="hljs-string">'labels'</span>]
        
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span><span class="hljs-params">(self, tasks, **kwargs)</span>:</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span><span class="hljs-params">(self, completions, **kwargs)</span>:</span>
        <span class="hljs-keyword">pass</span></code></pre>

<h3 id="Create-ML-backend-configs-amp-scripts"><a href="#Create-ML-backend-configs-amp-scripts" class="headerlink" title="Create ML backend configs &amp; scripts"></a>Create ML backend configs &amp; scripts</h3><p>Label Studio can automatically create all necessary configs and scripts needed to run ML backend from your newly created model.</p>
<p>Let’s call ML backend <code>my_backend</code> and initialize ML backend directory <code>./my_backend</code>:</p>
<pre><code class="hljs bash">label-studio-ml init my_backend</code></pre>

<p>The later command takes your script <code>./model.py</code> then creates <code>./my_backend</code> directory at the same level and copies configs and scripts needed for launching ML backend either in development or production modes.</p>
<blockquote>
<p>Note: You can specify different location for your model script, e.g. <code>label-studio init my_backend --script /path/to/my/script.py</code></p>
</blockquote>
<h3 id="Launch-ML-backend-server"><a href="#Launch-ML-backend-server" class="headerlink" title="Launch ML backend server"></a>Launch ML backend server</h3><h4 id="Development-mode"><a href="#Development-mode" class="headerlink" title="Development mode"></a>Development mode</h4><p>In a development mode, training and inference are done in a single process, therefore the server doesn’t respond to incoming predictions requests while the model trains.</p>
<p>In order to launch ML backend server in a Flask development mode, run</p>
<pre><code class="hljs bash">label-studio-ml start my_backend</code></pre>

<p>The server started on <code>http://localhost:9090</code> and outputs logs in console.</p>
<h4 id="Production-mode"><a href="#Production-mode" class="headerlink" title="Production mode"></a>Production mode</h4><p>Production mode is powered by Redis server and RQ jobs that take care of backround training processes. It means that you can start training your model and continue making requests for predictions from current model state.<br>Once the model training process is finished, the new model version updates automatically.</p>
<p>For production mode, please make sure you have docker and docker-compose installed on your system. Then execute:</p>
<pre><code class="hljs bash"><span class="hljs-built_in">cd</span> my_backend/
docker-compose up</code></pre>

<p>Now you can explore runtime logs in <code>my_backend/logs/uwsgi.log</code> and RQ training logs in <code>my_backend/logs/rq.log</code></p>
<h3 id="Using-ML-backend-with-Label-Studio"><a href="#Using-ML-backend-with-Label-Studio" class="headerlink" title="Using ML backend with Label Studio"></a>Using ML backend with Label Studio</h3><p>Initialize and start new Label Studio project connecting to the running ML backend:</p>
<pre><code class="hljs bash">label-studio start --init --ml-backend-url http://localhost:9090</code></pre>

<h4 id="Getting-predictions"><a href="#Getting-predictions" class="headerlink" title="Getting predictions"></a>Getting predictions</h4><p>You should see model predictions in a labeling interface.</p>
<h4 id="Model-training"><a href="#Model-training" class="headerlink" title="Model training"></a>Model training</h4><p>Model training is triggered manually by pushing <code>Start training</code> button on <a href="http://localhost:8080/model" target="_blank" rel="noopener">/model</a> page, or by using an API call:</p>
<pre><code class="hljs bash">curl -X POST http://localhost:8080/api/train</code></pre>


  

  <div class="footer-slack">
    <a href="https://join.slack.com/t/label-studio/shared_invite/zt-cr8b7ygm-6L45z7biEBw4HXa5A2b5pw">
      Could not find what you were looking for or have found an error? Please drop us a note on
      Slack&nbsp;<img style="height: 18px; position: absolute" src="/images/slack.png">
    </a>
  </div>
</div>

        </div>
    

    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>
    
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-129877673-4', 'auto');
	ga('send', 'pageview');
</script>

  </body>
</html>
